# Prompt: Create Test Fixtures for FEAT-001

**ID**: PROMPT-001
**Target**: FEAT-001 (LoadDEM)
**Type**: Infrastructure / Test Data
**Prerequisites**: Real `rasterio` installed (not stubs)

---

## Context

You are Claude Code working in the repository "tower-planner".

Your task is to create a complete Pull Request adding **test fixtures** for
FEAT-001, without modifying any domain or adapter logic. This PR is purely
about *test data infrastructure*, not feature development.

---

## Prerequisites

This PR requires **real rasterio** to be installed (not stubs):

```bash
pip install rasterio numpy pyproj
```

The generator script will create binary GeoTIFF files that will be
**committed to the repository** for reproducibility.

---

## Goals

### 1. Create folder structure

```
tests/fixtures/
scripts/
```

### 2. Add ALL fixtures from spec (17 files — 16 GeoTIFFs + 1 PNG)

| Fixture | Size | Purpose | TC |
|---------|------|---------|-----|
| `dem_100x100_4326.tif` | 100×100 | Happy path, EPSG:4326, float32 | TC-001 |
| `dem_utm23s.tif` | 50×50 | UTM Zone 23S (EPSG:31983), needs reprojection | TC-002 |
| `dem_with_nodata.tif` | 20×20 | Has nodata value defined, some masked pixels | TC-004 |
| `dem_all_nodata.tif` | 10×10 | 100% nodata → triggers AllNoDataError | TC-005 |
| `dem_all_nodata_partial.tif` | 20×20 | East half nodata, for partial nodata path tests | FEAT-002 TC-014 ¹ |
| `dem_no_crs.tif` | 10×10 | Missing CRS tag → triggers MissingCRSError | TC-006 |
| `rgb_image.tif` | 10×10×3 | 3-band RGB → triggers InvalidRasterError | TC-007 |
| `dem_known_values_4326.tif` | 20×20 | Known pixel[10,10]=150.5 for bit-exact test | TC-009 |
| `dem_known_values_4326_int16.tif` | 20×20 | Same as above but int16 dtype | TC-009b |
| `empty.tif` | 0 bytes | Empty file → triggers InvalidRasterError | TC-010 |
| `dem_85pct_nodata.tif` | 20×20 | ~85% nodata → logs warning but loads | TC-011 |
| `dem_large.tif` | 500×500 | Larger file for memory budget tests | TC-012, TC-018 |
| `dem_extreme_elevations.tif` | 10×10 | Contains -430m and +8849m values | TC-013 |
| `image.png` | 10×10 | Non-GeoTIFF → triggers InvalidRasterError | TC-014 |
| `dem_corrupted.tif` | ~100 bytes | Truncated/invalid TIFF header | TC-015 |
| `dem_polar_extreme.tif` | 10×10 | Bounds outside WGS84 after reproject | TC-016 |
| `dem_nan_transform.tif` | 10×10 | Geotransform with NaN → InvalidGeotransformError | TC-019 |

¹ Included early for FEAT-002 dependency. This fixture is generated alongside FEAT-001 fixtures to avoid a second fixture-generation PR.

### 3. Create generator script

```
scripts/gen_fixtures.py
```

- Must generate ALL fixtures programmatically
- Must be runnable: `python scripts/gen_fixtures.py`
- Must be idempotent (can re-run safely)
- Must document each fixture inline with comments

### 4. Create README

```
tests/fixtures/README.md
```

- Document each fixture with: purpose, CRS, dtype, nodata value, expected test behavior
- Reference FEAT-001 test cases (TC-XXX)
- Include generation instructions

### 5. Add sanity tests

```
tests/gis/test_fixtures_sanity.py
```

- Validate each fixture loads with `rasterio.open()`
- Check: exists, opens, shape matches, CRS matches (if applicable)
- NO behavioral tests (those are in FEAT-001 adapter tests)
- Mark with `@pytest.mark.integration` (requires real rasterio)

### 6. Update .gitignore

- Do NOT gitignore fixtures (they should be committed for CI reproducibility)
- Add comment explaining why fixtures are tracked

---

## PR Structure

**Branch**: `fixtures/feat-001-test-data`

**Commits** (in order):
1. `feat(fixtures): add gen_fixtures.py script`
2. `feat(fixtures): generate all FEAT-001 test fixtures`
3. `test(fixtures): add sanity checks for fixture validity`
4. `docs(fixtures): add README documenting each fixture`

**PR Title**: `feat(test): add synthetic DEM fixtures for FEAT-001`

**PR Description**:

```markdown
## Summary

Adds test fixtures infrastructure for FEAT-001 (LoadDEM) integration tests.

## What's included

- 17 synthetic fixtures (16 GeoTIFFs + 1 PNG) covering all FEAT-001 test cases (TC-001 to TC-019)
- Generator script (`scripts/gen_fixtures.py`) for reproducibility
- Sanity tests validating fixture integrity
- Documentation for each fixture

## Why committed (not generated on CI)

Fixtures are binary files generated by rasterio. Committing them ensures:
- CI doesn't need heavy GDAL/rasterio deps just to generate test data
- Reproducibility across environments
- Faster CI runs

## Test plan

- [ ] `python scripts/gen_fixtures.py` runs without error
- [ ] `pytest tests/gis/test_fixtures_sanity.py -m integration` passes
- [ ] All 17 fixtures (16 GeoTIFFs + 1 PNG) exist in `tests/fixtures/`
- [ ] README documents each fixture with TC reference

## SPEC Reference

- FEAT-001 v1.9.0 (Test Fixtures section)
```

---

## Constraints

| Rule | Description |
|------|-------------|
| NO domain changes | Do not modify `domain/*` |
| NO adapter changes | Do not modify `src/infrastructure/*` |
| NO spec changes | Do not modify `spec/*` |
| NO new features | This is test infrastructure only |
| NO stubs | Requires real rasterio installation |
| Minimal size | Keep fixtures small (10-100px) except dem_large.tif |
| Total size | Keep total fixture size under 1MB if possible |

---

## Fixture Generation Notes

### Special cases

1. **dem_no_crs.tif**: Use `rasterio` with `crs=None` or strip CRS after creation
2. **dem_corrupted.tif**: Write partial TIFF header bytes, then truncate
3. **dem_nan_transform.tif**: May need manual binary editing or custom transform
4. **dem_polar_extreme.tif**: Use Antarctic/Arctic coordinates that overflow WGS84 bounds when reprojected
5. **empty.tif**: Simply `touch` or `open(path, 'wb').close()`

### Coordinate reference systems

| CRS | EPSG | Usage |
|-----|------|-------|
| WGS84 | 4326 | Default output CRS |
| SIRGAS 2000 / UTM 23S | 31983 | Brazilian UTM for reprojection test |

---

## Validation Checklist

After PR is complete, verify:

- [ ] All 17 fixtures (16 GeoTIFFs + 1 PNG) exist in `tests/fixtures/`
- [ ] `scripts/gen_fixtures.py` is executable and documented
- [ ] `tests/fixtures/README.md` documents all fixtures
- [ ] `tests/gis/test_fixtures_sanity.py` passes with real rasterio
- [ ] No changes to `domain/`, `src/infrastructure/`, or `spec/`
- [ ] Total fixture size < 1MB
- [ ] PR description matches template above

---

<!-- PROMPT-001 v1.0.0 - Test fixtures for FEAT-001 -->
